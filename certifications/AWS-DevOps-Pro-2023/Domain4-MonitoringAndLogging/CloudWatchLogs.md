# CloudWatch logs
Define Log groups - arbitrary name, usually repping the app name
Define Log stream - instances with app / log file / containers
Define expiration date, never or 10years
can send logs to 
* S3, Kinesis DataStreams, Firehose, Lambda, OpenSearch
Encrypted by default or use own KMS keys

Sources
* SDK, CloudWatch Unified Agent
* Beanstalk - collection of logs from app
* ECS - collection from containers 
* Lambda - collection of function logs 
* VPC flow logs - VPC Specific logs
* API Gateway
* CloudTrail based on filter
* Route53 Log DNS queries

## Logs Insights
Search and analyze data in CW Logs
Lots of common queries

purpose built query language
Create query for logs based on fields, conditions, etc
Based on time frame nd log group
auto discover field from AWS services
calculate aggregate stats 
sort elements

Can save queries and add to CW Dashboards
Can query multiple log groups in different AWS Accounts
Not a real time engine, only query historical data

## Exports
* S3 export
    * can take up to 12 hours to become available for export
    * API call is CreateExportTask
    * Not near real time or realtime - use Log Subscription

* log Subscription
    * get real time stream from CW Logs
    * send to Kineses Data stream, Firehose, Lambda
        * Firehose to get near real time to S3 or OpenSearch
        * Lambda to get read time to OpenSearch
    * Subscription filter - filter logs/events that are delivered to destination
        * enable log aggregation from multi account and multi region
        * Cross account Subscription
            * Create a Subscription destination
            * Create access policy

## Metric Filter
expressions to filter to find specific phrases in a log
and then create a metric out of it
Can be used to trigger alarms

DOES NOT retroactively filter data

Specify 3 dimensions for a metric filter

# All Kinds of Logs
Application Logs
* produced by app code
* Contain custom messages, stack traces, etc.
* written to local file on filesystem
* usually streamed to CW Logs using CW Agent
* Lambda has direct integration
* ECS or Fargate has direct integration
* Beanstalk has direct integration using agent pre installed 

Operating system logs
* generated by OS, on EC2 or on prem
* inform of system behavior /var/log/messages, etc
* install cloudwatch unified agent

Access logs
* list all request for individual files have requested from website
* LBs, Proxies, web services, etc.
* AWS provides some access logs

AWS Managed Logs
* LB access logs -> S3
* Cloudtrail Logs -> S3 or CW Logs
    * API Calls made within AWS Account
* VPC Flow logs -> S3 or CW logs
    * info about IP traffic in VPC
* R53 logs -> CW Logs
    * queries that R53 receives
* S3 access logs -> to S3
    * server access logging provides detailed records for the requests that are made to a bucket
* CloudFront Access logs -> s3
    * detailed info about every user request CF receives


# CloudWatch Agent and Logs Agent
By default, no logs from EC2 go to CW Logs
Need to run agent
Needs IAM permissions to allow to send logs
Log agent can be set up on prem too

2 agents
* logs agent - older
    * Can only send logs
* Unified Agent - newer
    * can send system level metrics (RAM, processes, etc.) 
        * CPU Metrics at more granular
        * Disk Metrics at more granular
        * RAM at more granular
        * Netstat at more granular
        * Processes at more granular
        * Swap Space
    * EC2 out of box is much higher level
    * Can send logs
    * centralized config using SSM Param store


